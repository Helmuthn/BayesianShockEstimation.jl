```@meta
CurrentModule = BayesianShockEstimation
```

# BayesianShockEstimation

Documentation for [BayesianShockEstimation](https://github.com/Helmuthn/BayesianShockEstimation.jl).

There are three main parts of the code for this project.
 * Pushing Densities into Shockwaves
 * Godunov scheme for numerically solving Burgers' equation
 * RTS Sampling of a random walk

The novelty in this work comes from the numerical computation of shockwave densities,
while the other sections can be considered standard.

## Shockwave Density

First, we introduce two structs for configuration of the simulation. 
The first focuses on the numerical details, while the second focuses on the boundary conditions.
```@docs
ShockParams
BoundaryParams
```

Using these structs for configuration, the main function in this work computes the approximate shockwave arrival rate with a given number of Monte Carlo samples.
```@docs
ShockDensity
```

Within the function we do in-place updates to count of shockwaves from Monte Carlo samples using `IncrementShockCounts!`.
```@docs
IncrementShockCounts!
```

`IncrementShockCounts!` makes heavy use of `rangefilter`, which computes the difference magnitude of the range in some arbitrariy kernel described by an array of offset tuples.
```@docs
rangefilter
```

The offsets defining a particular ball can be computed using the helper function `getoffsets`.
```@docs
getoffsets
```


## Godunov Scheme for Burgers' Equation

To numerically compute the locations of shockwaves, we use Godunov's scheme for a discretization due to the balance of computational efficiency and the lack of advection error.

It is important to note that Gudonov's scheme introduces artificial viscosity into Burgers' equation, and so we only search for regions with large derivatives.

The highest level function for this section is `godunov_burgers_1D_shocks`, which returns a 2D array of booleans indicating the locations of shocks for given boundary conditions.
```@docs
godunov_burgers_1D_shocks
```

One step lower level is the numerical solver itself.
```@docs
godunov_burgers_1D
```

Individual timesteps are completed using `godunov_burgers_1D_step!`, which operates on a pre-allocated array.
```@docs
godunov_burgers_1D_step!
```

The flux function for Burgers equation is represented as `flux_burgers`.
```@docs
flux_burgers
```

For any given boundary, the net flux is computed through an exact solution of the Riemann problem in `riemann_solver_burgers`.
```@docs
riemann_solver_burgers
```

Finally, there are two helper functions to deal with fused operations and periodic boundary conditions.
```@docs
riemann_solver_burgers!
flux_difference!
```


## RTS Sampler for the Random Walk Model

Because the shockwave arrival rate estimation arises by pushing the boundary density through an implicit transformation, we include an implementation of an RTS sampler to sample the conditional boundary distribution given observations under a random walk model.

The sampler makes use of RTS smoothing variances, Kalman filter estimates, and Kalman filter variances, all of which are generated by `RTS_Smooth`.
```@docs
RTS_Smooth
```

The results of `RTS_Smooth` can then be used in `RTS_sample` to generate a single trajectory sample according to the RTS smoothing distribution.
```@docs
RTS_sample
```

The initial Kalman filter estimates are constructed through `KalmanFilterWalk`.
```@docs
KalmanFilterWalk
```

The RTS variances are constructed through `BackwardsVarianceWalk`.
```@docs
BackwardsVarianceWalk
```
